<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vlessè½¬Clash YAMLå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        .content {
            padding: 30px;
        }
        .input-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        textarea, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
        }
        textarea:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        .output-area {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
            min-height: 150px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-convert {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-convert:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-copy {
            background: #10b981;
            color: white;
        }
        .btn-copy:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        .btn-clear {
            background: #ef4444;
            color: white;
        }
        .btn-clear:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        .alert.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .alert.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .tips {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .tips h3 {
            color: #1e40af;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .tips ul {
            color: #1e3a8a;
            margin-left: 20px;
            line-height: 1.8;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ Vlessè½¬Clash YAMLå·¥å…·</h1>
            <p>å¿«é€Ÿå°†vlessé“¾æ¥è½¬æ¢ä¸ºclashé…ç½®æ ¼å¼</p>
        </div>
        
        <div class="content">
            <div id="alert" class="alert"></div>
            
            <div class="input-group">
                <label for="vlessInput">ğŸ“¥ è¾“å…¥Vlessé“¾æ¥ï¼ˆæ”¯æŒæ‰¹é‡ï¼Œæ¯è¡Œä¸€ä¸ªï¼‰</label>
                <textarea id="vlessInput" placeholder="vless://uuid@server:port?å‚æ•°...#èŠ‚ç‚¹åç§°"></textarea>
            </div>
            
            <div class="button-group">
                <button class="btn-convert" onclick="convertVless()">ğŸ”„ è½¬æ¢</button>
                <button class="btn-copy" onclick="copyResult()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                <button class="btn-clear" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
            
            <div class="input-group" style="margin-top: 25px;">
                <label>ğŸ“¤ è½¬æ¢ç»“æœ</label>
                <div id="output" class="output-area">ç­‰å¾…è½¬æ¢...</div>
            </div>
            
            <div class="tips">
                <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
                <ul>
                    <li>æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡è½¬æ¢vlessé“¾æ¥</li>
                    <li>è‡ªåŠ¨è¯†åˆ«realityã€wsã€grpcç­‰ä¼ è¾“åè®®</li>
                    <li>ç”Ÿæˆçš„æ ¼å¼å¯ç›´æ¥æ·»åŠ åˆ°clashé…ç½®æ–‡ä»¶</li>
                    <li>æ”¯æŒä¸€é”®å¤åˆ¶ç»“æœ</li>
                </ul>
            </div>
            
            <div class="tips" style="background: #fef2f2; border-left-color: #ef4444;">
                <h3 style="color: #991b1b;">âš ï¸ å®‰å…¨è­¦å‘Š</h3>
                <ul style="color: #7f1d1d;">
                    <li><strong>security=noneï¼ˆæ— åŠ å¯†ï¼‰</strong>ï¼šæµé‡æ˜æ–‡ä¼ è¾“ï¼Œå¯è¢«çªƒå¬ï¼Œéå¸¸ä¸å®‰å…¨ï¼</li>
                    <li><strong>æ¨èä½¿ç”¨</strong>ï¼šå¸¦TLSåŠ å¯†çš„èŠ‚ç‚¹ï¼ˆsecurity=tlsï¼‰æˆ–Realityåè®®</li>
                    <li><strong>å…¬å…±ç½‘ç»œ</strong>ï¼šç»å¯¹ä¸è¦åœ¨å…¬å…±WiFiä½¿ç”¨æ— åŠ å¯†èŠ‚ç‚¹</li>
                    <li><strong>æ•æ„Ÿæ“ä½œ</strong>ï¼šæ¶‰åŠè´¦å·å¯†ç ã€æ”¯ä»˜ç­‰æ“ä½œæ—¶å¿…é¡»ä½¿ç”¨åŠ å¯†èŠ‚ç‚¹</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type} show`;
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        function parseVlessUrl(url) {
            try {
                // æ›´çµæ´»çš„è§£ævlessé“¾æ¥
                const urlPattern = /vless:\/\/([^@]+)@([^:/?]+):(\d+)\/?\??([^#]*)(#(.*))?/;
                const match = url.match(urlPattern);
                
                if (!match) {
                    throw new Error('æ— æ•ˆçš„vlessé“¾æ¥æ ¼å¼');
                }

                const [, uuid, server, port, params, , name] = match;
                const decodedName = name ? decodeURIComponent(name.trim()) : 'æœªå‘½åèŠ‚ç‚¹';
                
                // è§£æå‚æ•°
                const paramObj = {};
                if (params) {
                    params.split('&').forEach(param => {
                        const [key, value] = param.split('=');
                        if (key) {
                            paramObj[key] = value ? decodeURIComponent(value) : '';
                        }
                    });
                }

                // åˆ¤æ–­æ˜¯å¦æœ‰TLS/åŠ å¯†
                const hasTLS = paramObj.security && paramObj.security !== 'none';
                const security = paramObj.security || 'none';

                // æ„å»ºclashé…ç½®
                const config = {
                    name: decodedName,
                    server: server,
                    port: parseInt(port),
                    type: 'vless',
                    uuid: uuid,
                    network: paramObj.type || 'tcp',
                    udp: true
                };

                // æ ¹æ®securityå†³å®šæ˜¯å¦å¯ç”¨tls
                if (hasTLS) {
                    config.tls = true;
                    config['skip-cert-verify'] = paramObj.allowInsecure === '1';
                    
                    // æ·»åŠ servername/sni
                    if (paramObj.sni) {
                        config.servername = paramObj.sni;
                    }

                    // æ·»åŠ fingerprint
                    if (paramObj.fp) {
                        config['client-fingerprint'] = paramObj.fp;
                    }

                    // æ·»åŠ flow
                    if (paramObj.flow) {
                        config.flow = paramObj.flow;
                    }
                } else {
                    // æ— åŠ å¯†è­¦å‘Šä¼šåœ¨ç»“æœä¸­æ ‡æ³¨
                    config.tls = false;
                }

                // Realityé…ç½®
                if (security === 'reality') {
                    const realityOpts = {};
                    if (paramObj.pbk) {
                        realityOpts['public-key'] = paramObj.pbk;
                    }
                    if (paramObj.sid) {
                        realityOpts['short-id'] = paramObj.sid;
                    }
                    if (Object.keys(realityOpts).length > 0) {
                        config['reality-opts'] = realityOpts;
                    }
                }

                // WebSocketé…ç½®
                if (paramObj.type === 'ws') {
                    const wsOpts = {};
                    if (paramObj.path) {
                        wsOpts.path = paramObj.path;
                    }
                    if (paramObj.host) {
                        wsOpts.headers = { Host: paramObj.host };
                    }
                    if (Object.keys(wsOpts).length > 0) {
                        config['ws-opts'] = wsOpts;
                    }
                }

                // gRPCé…ç½®
                if (paramObj.type === 'grpc') {
                    const grpcOpts = {};
                    if (paramObj.serviceName) {
                        grpcOpts['grpc-service-name'] = paramObj.serviceName;
                    }
                    if (Object.keys(grpcOpts).length > 0) {
                        config['grpc-opts'] = grpcOpts;
                    }
                }

                // æ ‡è®°æ˜¯å¦å®‰å…¨
                config._isSecure = hasTLS;

                return config;
            } catch (error) {
                throw new Error(`è§£æå¤±è´¥: ${error.message}`);
            }
        }

        function formatYaml(config) {
            // æ ¼å¼åŒ–ä¸ºå•è¡Œyaml
            const parts = [];
            for (const [key, value] of Object.entries(config)) {
                if (typeof value === 'object' && value !== null) {
                    // å¤„ç†åµŒå¥—å¯¹è±¡
                    const nestedParts = [];
                    for (const [nKey, nValue] of Object.entries(value)) {
                        nestedParts.push(`${nKey}: ${nValue}`);
                    }
                    parts.push(`${key}: { ${nestedParts.join(', ')} }`);
                } else if (typeof value === 'boolean') {
                    parts.push(`${key}: ${value}`);
                } else if (typeof value === 'number') {
                    parts.push(`${key}: ${value}`);
                } else {
                    parts.push(`${key}: ${value}`);
                }
            }
            return ` - { ${parts.join(', ')} }`;
        }

        function convertVless() {
            const input = document.getElementById('vlessInput').value.trim();
            const output = document.getElementById('output');
            
            if (!input) {
                showAlert('è¯·è¾“å…¥vlessé“¾æ¥', 'error');
                return;
            }

            try {
                const lines = input.split('\n').filter(line => line.trim());
                const results = [];
                let errorCount = 0;
                let insecureCount = 0;

                lines.forEach((line, index) => {
                    try {
                        const config = parseVlessUrl(line.trim());
                        const isSecure = config._isSecure;
                        delete config._isSecure; // åˆ é™¤å†…éƒ¨æ ‡è®°
                        
                        const yaml = formatYaml(config);
                        
                        if (!isSecure) {
                            results.push(`# âš ï¸ è­¦å‘Šï¼šæ­¤èŠ‚ç‚¹æœªå¯ç”¨åŠ å¯†(security=none)ï¼Œæµé‡æ˜æ–‡ä¼ è¾“ï¼Œä¸å®‰å…¨ï¼`);
                            insecureCount++;
                        }
                        results.push(yaml);
                    } catch (error) {
                        results.push(`# ç¬¬${index + 1}è¡Œè½¬æ¢å¤±è´¥: ${error.message}`);
                        errorCount++;
                    }
                });

                output.textContent = results.join('\n');
                
                if (errorCount === 0 && insecureCount === 0) {
                    showAlert(`âœ… æˆåŠŸè½¬æ¢ ${results.length} ä¸ªèŠ‚ç‚¹`, 'success');
                } else if (insecureCount > 0) {
                    showAlert(`âš ï¸ è½¬æ¢å®Œæˆï¼Œä½†å‘ç° ${insecureCount} ä¸ªä¸å®‰å…¨èŠ‚ç‚¹(æ— åŠ å¯†)`, 'error');
                } else {
                    showAlert(`âš ï¸ è½¬æ¢å®Œæˆï¼Œ${errorCount} ä¸ªèŠ‚ç‚¹å¤±è´¥`, 'error');
                }
            } catch (error) {
                showAlert(`è½¬æ¢å¤±è´¥: ${error.message}`, 'error');
                output.textContent = 'è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼';
            }
        }

        function copyResult() {
            const output = document.getElementById('output');
            const text = output.textContent;
            
            if (text === 'ç­‰å¾…è½¬æ¢...' || text === 'è½¬æ¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ ¼å¼') {
                showAlert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'error');
                return;
            }

            navigator.clipboard.writeText(text).then(() => {
                showAlert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(() => {
                // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showAlert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            });
        }

        function clearAll() {
            document.getElementById('vlessInput').value = '';
            document.getElementById('output').textContent = 'ç­‰å¾…è½¬æ¢...';
            showAlert('âœ… å·²æ¸…ç©º', 'success');
        }

        // æ”¯æŒå›è½¦é”®è½¬æ¢
        document.getElementById('vlessInput').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                convertVless();
            }
        });
    </script>
</body>
</html>
