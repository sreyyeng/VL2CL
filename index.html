<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vless to Clash è½¬æ¢å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 10px;
            border-radius: 2px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-size: 14px;
            font-weight: 500;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: 'Courier New', monospace;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        input[type="file"] {
            display: none;
        }

        .file-upload-label {
            padding: 12px 24px;
            border: 2px dashed #667eea;
            border-radius: 8px;
            display: inline-block;
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: #f0f4ff;
            border-color: #764ba2;
        }

        .proxy-list {
            margin-top: 20px;
        }

        .proxy-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .proxy-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .proxy-info {
            flex: 1;
        }

        .proxy-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .proxy-details {
            font-size: 12px;
            color: #666;
            font-family: 'Courier New', monospace;
        }

        .proxy-actions {
            display: flex;
            gap: 10px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
                justify-content: center;
            }

            .stats {
                flex-direction: column;
            }

            .proxy-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .proxy-actions {
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Vless to Clash è½¬æ¢å·¥å…·</h1>
            <p>è½»æ¾ç®¡ç†ä½ çš„ Vless èŠ‚ç‚¹é…ç½®</p>
        </div>

        <div class="content">
            <div id="alertBox" class="alert"></div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="proxyCount">0</div>
                    <div class="stat-label">èŠ‚ç‚¹æ•°é‡</div>
                </div>
            </div>

            <!-- å¯¼å…¥å·²æœ‰é…ç½® -->
            <div class="section">
                <div class="section-title">ğŸ“ å¯¼å…¥å·²æœ‰é…ç½®</div>
                <div class="button-group">
                    <label for="yamlFile" class="file-upload-label">
                        ğŸ“¤ é€‰æ‹© YAML æ–‡ä»¶
                    </label>
                    <input type="file" id="yamlFile" accept=".yaml,.yml" onchange="handleFileUpload(event)">
                    <button class="btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰èŠ‚ç‚¹</button>
                </div>
            </div>

            <!-- æ·»åŠ å•ä¸ªèŠ‚ç‚¹ -->
            <div class="section">
                <div class="section-title">â• æ·»åŠ å•ä¸ªèŠ‚ç‚¹</div>
                <div class="input-group">
                    <label for="singleVless">Vless é“¾æ¥</label>
                    <input type="text" id="singleVless" placeholder="vless://uuid@server:port?...#name">
                </div>
                <button class="btn-primary" onclick="addSingleProxy()">æ·»åŠ èŠ‚ç‚¹</button>
            </div>

            <!-- æ‰¹é‡æ·»åŠ èŠ‚ç‚¹ -->
            <div class="section">
                <div class="section-title">ğŸ“‹ æ‰¹é‡æ·»åŠ èŠ‚ç‚¹</div>
                <div class="input-group">
                    <label for="batchVless">Vless é“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea id="batchVless" placeholder="vless://uuid@server:port?...#name1&#10;vless://uuid@server:port?...#name2&#10;vless://uuid@server:port?...#name3"></textarea>
                </div>
                <button class="btn-primary" onclick="addBatchProxies()">æ‰¹é‡æ·»åŠ </button>
            </div>

            <!-- èŠ‚ç‚¹åˆ—è¡¨ -->
            <div class="section">
                <div class="section-title">ğŸ“Š èŠ‚ç‚¹åˆ—è¡¨</div>
                <div style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="batchRename()">ğŸ·ï¸ æ‰¹é‡é‡å‘½å</button>
                </div>
                <div id="proxyList" class="proxy-list">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <p>æš‚æ— èŠ‚ç‚¹ï¼Œè¯·æ·»åŠ  Vless é“¾æ¥</p>
                    </div>
                </div>
            </div>

            <!-- å¯¼å‡ºé…ç½® -->
            <div class="section">
                <div class="section-title">ğŸ’¾ å¯¼å‡ºé…ç½®</div>
                <button class="btn-success" onclick="exportYaml()">ğŸ“¥ ä¸‹è½½ Clash YAML æ–‡ä»¶</button>
            </div>
        </div>
    </div>

    <script>
        let proxies = [];

        // è§£æ Vless é“¾æ¥
        function parseVlessUrl(url) {
            try {
                if (!url.startsWith('vless://')) {
                    throw new Error('ä¸æ˜¯æœ‰æ•ˆçš„ Vless é“¾æ¥');
                }

                // ç§»é™¤ vless:// å‰ç¼€
                const content = url.substring(8);
                
                // åˆ†ç¦»å¤‡æ³¨åç§°
                let [main, name] = content.split('#');
                name = name ? decodeURIComponent(name) : 'VlessèŠ‚ç‚¹';

                // åˆ†ç¦»ç”¨æˆ·ä¿¡æ¯å’ŒæœåŠ¡å™¨ä¿¡æ¯
                const [userInfo, serverInfo] = main.split('@');
                const uuid = userInfo;

                // åˆ†ç¦»æœåŠ¡å™¨åœ°å€ã€ç«¯å£å’Œå‚æ•°
                const [serverPort, params] = serverInfo.split('?');
                const [server, port] = serverPort.split(':');

                // è§£æå‚æ•°
                const urlParams = new URLSearchParams(params);
                
                const security = urlParams.get('security') || urlParams.get('encryption') || 'none';
                const network = urlParams.get('type') || 'tcp';
                
                const proxy = {
                    name: name,
                    type: 'vless',
                    server: server,
                    port: parseInt(port),
                    uuid: uuid,
                    network: network,
                    tls: security === 'tls' || security === 'reality',
                    'skip-cert-verify': urlParams.get('allowInsecure') === '1' || urlParams.get('allowInsecure') === 'true'
                };

                // å¤„ç† TLS/SNI é…ç½®
                if (proxy.tls) {
                    const sni = urlParams.get('sni') || urlParams.get('peer') || urlParams.get('host');
                    if (sni) {
                        proxy.servername = sni;
                    }
                }

                // Flow æ§åˆ¶ï¼ˆReality å’Œ XTLS éœ€è¦ï¼‰
                const flow = urlParams.get('flow');
                if (flow) {
                    proxy.flow = flow;
                }

                // Reality åè®®æ”¯æŒ
                if (security === 'reality') {
                    const publicKey = urlParams.get('pbk') || urlParams.get('publicKey');
                    const shortId = urlParams.get('sid') || urlParams.get('shortId') || '';
                    
                    if (publicKey) {
                        proxy['reality-opts'] = {
                            'public-key': publicKey,
                            'short-id': shortId
                        };
                    }
                }

                // å¤„ç†ä¼ è¾“åè®®ç›¸å…³é…ç½®
                if (network === 'ws') {
                    proxy['ws-opts'] = {
                        path: urlParams.get('path') || '/',
                        headers: {}
                    };
                    const host = urlParams.get('host');
                    if (host) {
                        proxy['ws-opts'].headers.Host = host;
                    }
                } else if (network === 'grpc') {
                    proxy['grpc-opts'] = {
                        'grpc-service-name': urlParams.get('serviceName') || urlParams.get('service') || ''
                    };
                } else if (network === 'h2' || network === 'http') {
                    proxy['h2-opts'] = {
                        path: urlParams.get('path') || '/',
                        host: urlParams.get('host') ? [urlParams.get('host')] : []
                    };
                }

                return proxy;
            } catch (error) {
                console.error('è§£æ Vless é“¾æ¥å¤±è´¥:', error);
                throw error;
            }
        }

        // æ·»åŠ å•ä¸ªèŠ‚ç‚¹
        function addSingleProxy() {
            const input = document.getElementById('singleVless');
            const url = input.value.trim();

            if (!url) {
                showAlert('è¯·è¾“å…¥ Vless é“¾æ¥', 'error');
                return;
            }

            try {
                const proxy = parseVlessUrl(url);
                proxies.push(proxy);
                input.value = '';
                updateProxyList();
                showAlert(`æˆåŠŸæ·»åŠ èŠ‚ç‚¹: ${proxy.name}`, 'success');
            } catch (error) {
                showAlert(`è§£æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ‰¹é‡æ·»åŠ èŠ‚ç‚¹
        function addBatchProxies() {
            const input = document.getElementById('batchVless');
            const urls = input.value.trim().split('\n').filter(line => line.trim());

            if (urls.length === 0) {
                showAlert('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ª Vless é“¾æ¥', 'error');
                return;
            }

            let successCount = 0;
            let failCount = 0;

            urls.forEach(url => {
                try {
                    const proxy = parseVlessUrl(url.trim());
                    proxies.push(proxy);
                    successCount++;
                } catch (error) {
                    failCount++;
                    console.error('è§£æå¤±è´¥:', url, error);
                }
            });

            input.value = '';
            updateProxyList();
            showAlert(`æˆåŠŸæ·»åŠ  ${successCount} ä¸ªèŠ‚ç‚¹${failCount > 0 ? `ï¼Œå¤±è´¥ ${failCount} ä¸ª` : ''}`, 
                      failCount > 0 ? 'info' : 'success');
        }

        // æ‰¹é‡é‡å‘½å
        function batchRename() {
            if (proxies.length === 0) {
                showAlert('å½“å‰æ²¡æœ‰èŠ‚ç‚¹', 'info');
                return;
            }

            const action = prompt(
                'æ‰¹é‡é‡å‘½åé€‰é¡¹ï¼š\n' +
                '1. æ·»åŠ å‰ç¼€ï¼ˆè¾“å…¥ï¼šå‰ç¼€ ä½ çš„å‰ç¼€ï¼‰\n' +
                '2. æ·»åŠ åç¼€ï¼ˆè¾“å…¥ï¼šåç¼€ ä½ çš„åç¼€ï¼‰\n' +
                '3. æ‰¹é‡è®¾ç½®åºå·ï¼ˆè¾“å…¥ï¼šåºå· èµ·å§‹æ•°å­—ï¼‰\n' +
                'ä¾‹å¦‚ï¼šå‰ç¼€ é¦™æ¸¯-\n' +
                'ä¾‹å¦‚ï¼šåç¼€ -é«˜é€Ÿ\n' +
                'ä¾‹å¦‚ï¼šåºå· 1\n\n' +
                'è¯·è¾“å…¥ï¼š'
            );

            if (!action) return;

            const parts = action.trim().split(/\s+/);
            if (parts.length < 2) {
                showAlert('æ ¼å¼é”™è¯¯ï¼Œè¯·æŒ‰ç…§æç¤ºæ ¼å¼è¾“å…¥', 'error');
                return;
            }

            const [type, value] = [parts[0], parts.slice(1).join(' ')];
            let count = 0;

            if (type === 'å‰ç¼€') {
                proxies.forEach(proxy => {
                    proxy.name = value + proxy.name;
                    count++;
                });
                showAlert(`å·²ä¸º ${count} ä¸ªèŠ‚ç‚¹æ·»åŠ å‰ç¼€ "${value}"`, 'success');
            } else if (type === 'åç¼€') {
                proxies.forEach(proxy => {
                    proxy.name = proxy.name + value;
                    count++;
                });
                showAlert(`å·²ä¸º ${count} ä¸ªèŠ‚ç‚¹æ·»åŠ åç¼€ "${value}"`, 'success');
            } else if (type === 'åºå·') {
                const startNum = parseInt(value);
                if (isNaN(startNum)) {
                    showAlert('åºå·å¿…é¡»æ˜¯æ•°å­—', 'error');
                    return;
                }
                proxies.forEach((proxy, index) => {
                    const num = String(startNum + index).padStart(2, '0');
                    proxy.name = `[${num}] ${proxy.name}`;
                    count++;
                });
                showAlert(`å·²ä¸º ${count} ä¸ªèŠ‚ç‚¹æ·»åŠ åºå·`, 'success');
            } else {
                showAlert('æœªçŸ¥çš„æ“ä½œç±»å‹ï¼Œè¯·è¾“å…¥ï¼šå‰ç¼€ã€åç¼€ æˆ– åºå·', 'error');
                return;
            }

            updateProxyList();
        }

        // ç¼–è¾‘èŠ‚ç‚¹åç§°
        function editProxyName(index) {
            const proxy = proxies[index];
            const newName = prompt(`è¯·è¾“å…¥æ–°çš„èŠ‚ç‚¹åç§°ï¼š`, proxy.name);
            
            if (newName !== null && newName.trim() !== '') {
                const oldName = proxy.name;
                proxy.name = newName.trim();
                updateProxyList();
                showAlert(`èŠ‚ç‚¹ "${oldName}" å·²é‡å‘½åä¸º "${proxy.name}"`, 'success');
            }
        }

        // åˆ é™¤èŠ‚ç‚¹
        function deleteProxy(index) {
            const proxy = proxies[index];
            if (confirm(`ç¡®å®šè¦åˆ é™¤èŠ‚ç‚¹ "${proxy.name}" å—ï¼Ÿ`)) {
                proxies.splice(index, 1);
                updateProxyList();
                showAlert(`å·²åˆ é™¤èŠ‚ç‚¹: ${proxy.name}`, 'success');
            }
        }

        // æ¸…ç©ºæ‰€æœ‰èŠ‚ç‚¹
        function clearAll() {
            if (proxies.length === 0) {
                showAlert('å½“å‰æ²¡æœ‰èŠ‚ç‚¹', 'info');
                return;
            }

            if (confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ ${proxies.length} ä¸ªèŠ‚ç‚¹å—ï¼Ÿ`)) {
                proxies = [];
                updateProxyList();
                showAlert('å·²æ¸…ç©ºæ‰€æœ‰èŠ‚ç‚¹', 'success');
            }
        }

        // æ›´æ–°èŠ‚ç‚¹åˆ—è¡¨æ˜¾ç¤º
        function updateProxyList() {
            const listContainer = document.getElementById('proxyList');
            const countElement = document.getElementById('proxyCount');
            
            countElement.textContent = proxies.length;

            if (proxies.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <p>æš‚æ— èŠ‚ç‚¹ï¼Œè¯·æ·»åŠ  Vless é“¾æ¥</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = proxies.map((proxy, index) => {
                let details = `${proxy.server}:${proxy.port} | ${proxy.network}`;
                if (proxy.tls) details += ' + TLS';
                if (proxy['reality-opts']) details += ' (Reality)';
                if (proxy.flow) details += ` | flow: ${proxy.flow}`;
                
                return `
                    <div class="proxy-item">
                        <div class="proxy-info">
                            <div class="proxy-name">${proxy.name}</div>
                            <div class="proxy-details">${details}</div>
                        </div>
                        <div class="proxy-actions">
                            <button class="btn-secondary" onclick="editProxyName(${index})" style="padding: 6px 12px; font-size: 12px;">âœï¸ æ”¹å</button>
                            <button class="btn-danger" onclick="deleteProxy(${index})">åˆ é™¤</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // å¯¼å‡º YAML æ–‡ä»¶
        function exportYaml() {
            if (proxies.length === 0) {
                showAlert('æ²¡æœ‰å¯å¯¼å‡ºçš„èŠ‚ç‚¹', 'error');
                return;
            }

            const now = new Date();
            const timestamp = `${now.getFullYear()}/${String(now.getMonth() + 1).padStart(2, '0')}/${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;

            // ç”Ÿæˆå®Œæ•´çš„ Clash é…ç½®
            let yaml = `# Clash é…ç½®æ–‡ä»¶\n`;
            yaml += `# ç”± Vless è½¬æ¢å™¨ç”Ÿæˆ\n`;
            yaml += `# ç”Ÿæˆæ—¶é—´: ${timestamp}\n\n`;

            // åŸºç¡€é…ç½®
            yaml += `port: 7890\n`;
            yaml += `socks-port: 7891\n`;
            yaml += `allow-lan: true\n`;
            yaml += `mode: Rule\n`;
            yaml += `log-level: info\n`;
            yaml += `external-controller: :9090\n\n`;

            // DNS é…ç½®
            yaml += `dns:\n`;
            yaml += `  enable: true\n`;
            yaml += `  nameserver:\n`;
            yaml += `    - 119.29.29.29\n`;
            yaml += `    - 223.5.5.5\n`;
            yaml += `  fallback:\n`;
            yaml += `    - 8.8.8.8\n`;
            yaml += `    - 1.0.0.1\n`;
            yaml += `    - tls://dns.google\n\n`;

            // ä»£ç†èŠ‚ç‚¹é…ç½®
            yaml += `proxies:\n`;
            
            proxies.forEach(proxy => {
                yaml += `  - name: "${proxy.name}"\n`;
                yaml += `    server: ${proxy.server}\n`;
                yaml += `    port: ${proxy.port}\n`;
                yaml += `    type: ${proxy.type}\n`;
                yaml += `    uuid: ${proxy.uuid}\n`;
                yaml += `    network: ${proxy.network}\n`;
                
                if (proxy.tls !== undefined) {
                    yaml += `    tls: ${proxy.tls}\n`;
                }
                
                // UDP æ”¯æŒï¼ˆé»˜è®¤å¼€å¯ï¼‰
                yaml += `    udp: true\n`;
                
                if (proxy['skip-cert-verify'] !== undefined) {
                    yaml += `    skip-cert-verify: ${proxy['skip-cert-verify']}\n`;
                }
                
                if (proxy.servername) {
                    yaml += `    servername: ${proxy.servername}\n`;
                }
                
                if (proxy.flow) {
                    yaml += `    flow: ${proxy.flow}\n`;
                }
                
                // Reality åè®®é…ç½®
                if (proxy['reality-opts']) {
                    yaml += `    reality-opts:\n`;
                    yaml += `      public-key: ${proxy['reality-opts']['public-key']}\n`;
                    if (proxy['reality-opts']['short-id']) {
                        yaml += `      short-id: ${proxy['reality-opts']['short-id']}\n`;
                    }
                    // Reality éœ€è¦ client-fingerprint
                    yaml += `    client-fingerprint: chrome\n`;
                }
                
                // WebSocket é…ç½®
                if (proxy['ws-opts']) {
                    yaml += `    ws-opts:\n`;
                    yaml += `      path: ${proxy['ws-opts'].path}\n`;
                    if (proxy['ws-opts'].headers && proxy['ws-opts'].headers.Host) {
                        yaml += `      headers:\n`;
                        yaml += `        Host: ${proxy['ws-opts'].headers.Host}\n`;
                    }
                }
                
                // gRPC é…ç½®
                if (proxy['grpc-opts']) {
                    yaml += `    grpc-opts:\n`;
                    yaml += `      grpc-service-name: ${proxy['grpc-opts']['grpc-service-name']}\n`;
                }
                
                // HTTP/2 é…ç½®
                if (proxy['h2-opts']) {
                    yaml += `    h2-opts:\n`;
                    yaml += `      path: ${proxy['h2-opts'].path}\n`;
                    if (proxy['h2-opts'].host && proxy['h2-opts'].host.length > 0) {
                        yaml += `      host:\n`;
                        proxy['h2-opts'].host.forEach(h => {
                            yaml += `        - ${h}\n`;
                        });
                    }
                }
            });

            yaml += '\n';

            // è·å–æ‰€æœ‰èŠ‚ç‚¹åç§°
            const proxyNames = proxies.map(p => `      - ${p.name}`).join('\n');

            // ä»£ç†ç»„é…ç½®
            yaml += `proxy-groups:\n`;
            
            yaml += `  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += proxyNames + '\n';
            yaml += `      - DIRECT\n\n`;

            yaml += `  - name: ğŸ“² ç”µæŠ¥æ¶ˆæ¯\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += proxyNames + '\n';
            yaml += `      - DIRECT\n\n`;

            yaml += `  - name: ğŸ’¬ AIå¹³å°\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += proxyNames + '\n';
            yaml += `      - DIRECT\n\n`;

            yaml += `  - name: ğŸ“¹ æ²¹ç®¡è§†é¢‘\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += proxyNames + '\n';
            yaml += `      - DIRECT\n\n`;

            yaml += `  - name: ğŸ¥ å¥ˆé£è§†é¢‘\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += proxyNames + '\n';
            yaml += `      - DIRECT\n\n`;

            yaml += `  - name: ğŸŒ å›½å¤–åª’ä½“\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += proxyNames + '\n';
            yaml += `      - DIRECT\n\n`;

            yaml += `  - name: ğŸ¯ å…¨çƒç›´è¿\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - DIRECT\n`;
            yaml += `      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += proxyNames + '\n\n';

            yaml += `  - name: ğŸ›‘ å¹¿å‘Šæ‹¦æˆª\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - REJECT\n`;
            yaml += `      - DIRECT\n\n`;

            yaml += `  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼\n`;
            yaml += `    type: select\n`;
            yaml += `    proxies:\n`;
            yaml += `      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += proxyNames + '\n';
            yaml += `      - DIRECT\n\n`;

            // è·¯ç”±è§„åˆ™
            yaml += `rules:\n`;
            yaml += `  # å±€åŸŸç½‘ç›´è¿\n`;
            yaml += `  - DOMAIN-SUFFIX,local,ğŸ¯ å…¨çƒç›´è¿\n`;
            yaml += `  - IP-CIDR,192.168.0.0/16,ğŸ¯ å…¨çƒç›´è¿,no-resolve\n`;
            yaml += `  - IP-CIDR,10.0.0.0/8,ğŸ¯ å…¨çƒç›´è¿,no-resolve\n`;
            yaml += `  - IP-CIDR,172.16.0.0/12,ğŸ¯ å…¨çƒç›´è¿,no-resolve\n`;
            yaml += `  - IP-CIDR,127.0.0.0/8,ğŸ¯ å…¨çƒç›´è¿,no-resolve\n`;
            yaml += `  # Telegram\n`;
            yaml += `  - DOMAIN-SUFFIX,t.me,ğŸ“² ç”µæŠ¥æ¶ˆæ¯\n`;
            yaml += `  - DOMAIN-SUFFIX,telegram.org,ğŸ“² ç”µæŠ¥æ¶ˆæ¯\n`;
            yaml += `  - IP-CIDR,91.108.4.0/22,ğŸ“² ç”µæŠ¥æ¶ˆæ¯,no-resolve\n`;
            yaml += `  - IP-CIDR,91.108.8.0/22,ğŸ“² ç”µæŠ¥æ¶ˆæ¯,no-resolve\n`;
            yaml += `  - IP-CIDR,149.154.160.0/20,ğŸ“² ç”µæŠ¥æ¶ˆæ¯,no-resolve\n`;
            yaml += `  # AI å¹³å°\n`;
            yaml += `  - DOMAIN-SUFFIX,openai.com,ğŸ’¬ AIå¹³å°\n`;
            yaml += `  - DOMAIN-SUFFIX,anthropic.com,ğŸ’¬ AIå¹³å°\n`;
            yaml += `  - DOMAIN-SUFFIX,claude.ai,ğŸ’¬ AIå¹³å°\n`;
            yaml += `  - DOMAIN-SUFFIX,chatgpt.com,ğŸ’¬ AIå¹³å°\n`;
            yaml += `  # YouTube\n`;
            yaml += `  - DOMAIN-SUFFIX,youtube.com,ğŸ“¹ æ²¹ç®¡è§†é¢‘\n`;
            yaml += `  - DOMAIN-SUFFIX,googlevideo.com,ğŸ“¹ æ²¹ç®¡è§†é¢‘\n`;
            yaml += `  - DOMAIN-SUFFIX,ytimg.com,ğŸ“¹ æ²¹ç®¡è§†é¢‘\n`;
            yaml += `  # Netflix\n`;
            yaml += `  - DOMAIN-SUFFIX,netflix.com,ğŸ¥ å¥ˆé£è§†é¢‘\n`;
            yaml += `  - DOMAIN-SUFFIX,nflxvideo.net,ğŸ¥ å¥ˆé£è§†é¢‘\n`;
            yaml += `  # å›½å¤–åª’ä½“\n`;
            yaml += `  - DOMAIN-SUFFIX,twitter.com,ğŸŒ å›½å¤–åª’ä½“\n`;
            yaml += `  - DOMAIN-SUFFIX,x.com,ğŸŒ å›½å¤–åª’ä½“\n`;
            yaml += `  - DOMAIN-SUFFIX,facebook.com,ğŸŒ å›½å¤–åª’ä½“\n`;
            yaml += `  - DOMAIN-SUFFIX,instagram.com,ğŸŒ å›½å¤–åª’ä½“\n`;
            yaml += `  # Google\n`;
            yaml += `  - DOMAIN-SUFFIX,google.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += `  - DOMAIN-SUFFIX,googleapis.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += `  - DOMAIN-SUFFIX,gstatic.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©\n`;
            yaml += `  # å¹¿å‘Šæ‹¦æˆª\n`;
            yaml += `  - DOMAIN-KEYWORD,ads,ğŸ›‘ å¹¿å‘Šæ‹¦æˆª\n`;
            yaml += `  - DOMAIN-KEYWORD,adservice,ğŸ›‘ å¹¿å‘Šæ‹¦æˆª\n`;
            yaml += `  # ä¸­å›½ç›´è¿\n`;
            yaml += `  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿\n`;
            yaml += `  # å…¶ä»–å…¨éƒ¨èµ°ä»£ç†\n`;
            yaml += `  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼\n`;

            // åˆ›å»ºä¸‹è½½
            const blob = new Blob([yaml], { type: 'text/yaml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'clash-config.yaml';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showAlert(`æˆåŠŸå¯¼å‡º ${proxies.length} ä¸ªèŠ‚ç‚¹çš„å®Œæ•´é…ç½®æ–‡ä»¶`, 'success');
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    parseYamlFile(content);
                } catch (error) {
                    showAlert(`è¯»å–æ–‡ä»¶å¤±è´¥: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        // è§£æ YAML æ–‡ä»¶ï¼ˆç®€å•è§£æï¼‰
        function parseYamlFile(content) {
            try {
                const lines = content.split('\n');
                let currentProxy = null;
                let inProxiesSection = false;
                let importedCount = 0;

                for (let line of lines) {
                    const trimmed = line.trim();
                    
                    if (trimmed === 'proxies:') {
                        inProxiesSection = true;
                        continue;
                    }

                    if (inProxiesSection) {
                        if (trimmed.startsWith('- name:')) {
                            if (currentProxy && currentProxy.type === 'vless') {
                                proxies.push(currentProxy);
                                importedCount++;
                            }
                            currentProxy = {
                                name: trimmed.match(/name:\s*["']?(.+?)["']?$/)?.[1] || 'Unknown',
                                type: '',
                                server: '',
                                port: 0,
                                uuid: '',
                                cipher: 'auto'
                            };
                        } else if (currentProxy) {
                            if (trimmed.startsWith('type:')) {
                                currentProxy.type = trimmed.split(':')[1].trim();
                            } else if (trimmed.startsWith('server:')) {
                                currentProxy.server = trimmed.split(':')[1].trim();
                            } else if (trimmed.startsWith('port:')) {
                                currentProxy.port = parseInt(trimmed.split(':')[1].trim());
                            } else if (trimmed.startsWith('uuid:')) {
                                currentProxy.uuid = trimmed.split(':')[1].trim();
                            } else if (trimmed.startsWith('tls:')) {
                                currentProxy.tls = trimmed.split(':')[1].trim() === 'true';
                            } else if (trimmed.startsWith('network:')) {
                                currentProxy.network = trimmed.split(':')[1].trim();
                            } else if (trimmed.startsWith('servername:')) {
                                currentProxy.servername = trimmed.split(':')[1].trim();
                            }
                        }
                        
                        if (trimmed.startsWith('proxy-groups:')) {
                            inProxiesSection = false;
                        }
                    }
                }

                if (currentProxy && currentProxy.type === 'vless') {
                    proxies.push(currentProxy);
                    importedCount++;
                }

                updateProxyList();
                showAlert(`æˆåŠŸå¯¼å…¥ ${importedCount} ä¸ª Vless èŠ‚ç‚¹`, 'success');
            } catch (error) {
                showAlert(`è§£æ YAML æ–‡ä»¶å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = `alert alert-${type} show`;
            alertBox.textContent = message;
            
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 3000);
        }

        // åˆå§‹åŒ–
        updateProxyList();
    </script>
</body>
</html>
